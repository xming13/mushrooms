var XMing=XMing||{};XMing.GameStateManager=new function(){var b;var g=0;var f;var a;var e={};var d={INITIAL:"initial",START:"start",PAUSE:"pause",END:"end"};var c={SINGLE:"single",DOUBLE:"double",POISON:"poison"};this.init=function(){window.addEventListener("resize",this.onResize.bind(this),false);this.initGame()};this.loadData=function(){var h=this;var l="<li><div class='shroom-holder'><div class='image-holder'><img class='new-shroom' src='images/transparent.png' /></div></div></li>";var k=[];_.times(16,function(m){k.push(l)});$(".game-grid").html("");_.each(k,function(m){$(".game-grid").append(m)});this.onResize();$("html, body").scrollTop($("#panel-container").offset().top);a=60;(function j(){var m=_.random(1,4);_.each(_.sample($(".image-holder"),m),function(o){if(!$(o).data("type")){var n=_.sample(c);$(o).data("type",n);$(o).find("img").attr("src",e[n])}});_.each(_.filter($(".image-holder"),function(n){return $(n).data("type")&&!$(n).data("hasStarted")&&!$(n).data("hasStopped")}),function(p){var n=$(p);var o=n.parent().parent("li").height();n.css("top",o+"px").data("hasStarted",true).animate({top:"0px"},{duration:500,complete:function(){var q=$(this);setTimeout(function(){if(!q.data("hasStopped")){q.animate({top:o+"px"},{duration:500,complete:function(){q.css("top",o+"px").data("type","").data("isClicked","").data("hasStarted","")}})}},1000)}})});if(!h.isGameStateEnd()){setTimeout(j,2000)}})();$(".image-holder").click(function(){var q=$(this);if(q.data("type")&&!q.data("hasStopped")){var n=q.data("type");var m=q.find("img");var o;var s=false;switch(n){case c.SINGLE:m.attr("src",e[n+"-clicked"]);g++;o=$("<div class='score-popup animated bounceIn'>+1</div>");break;case c.DOUBLE:if(q.data("isClicked")){m.attr("src",e[n+"-clicked-twice"]);g+=2;o=$("<div class='score-popup animated bounceIn'>+2</div>")}else{q.data("isClicked",true);m.attr("src",e[n+"-clicked-once"]);s=true}break;case c.POISON:m.attr("src",e[n+"-clicked"]);g--;o=$("<div class='score-popup penalty animated bounceIn'>-1</div>");break}if(!s){$("#score-value").html(g);q.data("hasStopped",true).stop();var r=q.parent().parent("li");var p=$("<img src='images/mushroom-small.png' class='popup' />");o.prepend(p);r.prepend(o);o.css("top",(this.offsetTop-p.height())+"px");$(".score-popup").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){o.remove()});setTimeout(function(){o.remove();q.css("top",r.height()+"px").data("type","").data("isClicked","").data("hasStarted","").data("hasStopped","")},500)}}});(function i(){a-=1;$("#timer-value").html(Math.ceil(a));$("#timer-value").addClass("animated fadeIn");if(a<=0){clearTimeout(f);$("#result-content").html("Time's up!").addClass("animated bounceIn").css("color","rgba(17, 189, 255, 255)");$("#timer-value").removeClass("animated fadeIn");h.endGame()}else{f=setTimeout(i,1000)}})()};this.onResize=function(k){var i=$(".game-grid").children("li");var h=_.max(i,function(l){return $(l).width()});var j=$(h).width();_.each(i,function(l){$(l).height(j);$(l).find(".content:not(.last)").css("line-height",j+"px")})};this.preloadImage=function(){var n=new Image();n.src="images/mushroom.png";e[c.SINGLE]=n.src;var m=new Image();m.src="images/mushroom-clicked.png";e[c.SINGLE+"-clicked"]=m.src;var k=new Image();k.src="images/mushroom-double.png";e[c.DOUBLE]=k.src;var l=new Image();l.src="images/mushroom-double-clicked-once.png";e[c.DOUBLE+"-clicked-once"]=l.src;var j=new Image();j.src="images/mushroom-double-clicked-twice.png";e[c.DOUBLE+"-clicked-twice"]=j.src;var i=new Image();i.src="images/mushroom-poison.png";e[c.POISON]=i.src;var h=new Image();h.src="images/mushroom-poison-clicked.png";e[c.POISON+"-clicked"]=h.src};this.initGame=function(){b=d.INITIAL;this.preloadImage()};this.startGame=function(){b=d.START;g=0;$("#timer").show();$("#replay").hide();this.loadData()};this.endGame=function(){b=d.END;var h="<li><div class='content'><img src='images/mushroom.png' /></div></li>";h+="<li><div class='content'><img src='images/mushroom-clicked.png' /></div></li>";h+="<li><div class='content'><img src='images/mushroom-poison.png' /></div></li>";h+="<li><div class='content'><img src='images/mushroom-poison-clicked.png' /></div></li>";h+="<li><div class='content'>G</div></li>";h+="<li><div class='content'>A</div></li>";h+="<li><div class='content'>M</div></li>";h+="<li><div class='content'>E</div></li>";h+="<li><div class='content'>O</div></li>";h+="<li><div class='content'>V</div></li>";h+="<li><div class='content'>E</div></li>";h+="<li><div class='content'>R</div></li>";h+="<li><div class='content'><img src='images/mushroom-double.png' /></div></li>";h+="<li><div class='content'><img src='images/mushroom-double-clicked-once.png' /></div></li>";h+="<li><div class='content'><img src='images/mushroom-double-clicked-twice.png' /></div></li>";h+="<li><div class='content last'><img src='images/mushroom-small.png' class='small' /></div></li>";$(".game-grid").html(h);$("#timer").hide();$("#replay").show();$("#score-value").html(g);this.onResize();$("html, body").scrollTop($("#panel-container").offset().top);alert("Congratulations!\nYour score is "+g+"!\nThanks for playing!");$(".icon-repeat").click(function(){XMing.GameStateManager.startGame()})};this.isGameStateInitial=function(){return b==d.INITIAL};this.isGameStateStart=function(){return b==d.START};this.isGameStateEnd=function(){return b==d.END}};